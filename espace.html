<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-store" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Espace - AlaMath</title>
    <style>
        body {
            font-family: 'Poppins', Arial, sans-serif;
            background: #f0f6fb;
            color: #222;
            margin: 0;
            padding: 0;
            text-align: center;
        }
        .container {
            width: 94%;
            max-width: 700px;
            margin: 38px auto;
            background: #fff;
            padding: 32px 20px 20px 20px;
            border-radius: 18px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.13);
            text-align: center;
            animation: fadeIn 0.8s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px);}
            to { opacity: 1; transform: translateY(0);}
        }
        h2 {
            color: #004aad;
            margin-bottom: 0.6em;
        }
        .logout-btn {
            background: #ff4d4d;
            color: white;
            border: none;
            font-size: 1em;
            cursor: pointer;
            border-radius: 7px;
            margin-top: 10px;
            padding: 0.7em 1.3em;
            font-weight: bold;
            transition: background 0.2s;
        }
        .logout-btn:hover {
            background: #c00;
        }
        .user-data {
            text-align: left;
            font-size: 1.13em;
            margin: 1.2em 0;
            padding: 1.1em 1.3em;
            background: #f7faff;
            border-radius: 10px;
            box-shadow: 0 1px 6px #eef4fa;
            animation: fadeIn 1.2s;
        }
        .user-data b {
            color: #004aad;
        }
        .cours-section {
            text-align: left;
            margin: 1.2em 0;
            background: #e7f4ff;
            border-radius: 10px;
            padding: 1.1em 1.3em;
            box-shadow: 0 1px 6px #c5e8ff36;
            animation: fadeIn 1.5s;
        }
        .cours-title {
            font-size: 1.15em;
            font-weight: bold;
            color: #004aad;
            margin-bottom: 0.5em;
        }
        .cours-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 0.7em;
            margin-bottom: 0.8em;
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px #b9e5ff36;
            table-layout: fixed;
            word-break: break-word;
        }
        .cours-table th, .cours-table td {
            border: none;
            padding: 0.75em 0.8em;
            text-align: left;
        }
        .cours-table th {
            background: #dff1ff;
            color: #004aad;
            font-weight: 600;
            font-size: 1em;
            border-bottom: 2px solid #b3dfff;
        }
        .cours-table td {
            background: #f7fcfe;
            border-bottom: 1px solid #e8f4fc;
            font-size: 0.98em;
        }
        .cours-table tr:last-child td {
            border-bottom: none;
        }
        .cours-table tr:nth-child(even) td {
            background: #f0f8fd;
        }
        .dynamic-row {
            animation: rowFadeIn 0.7s;
        }
        @keyframes rowFadeIn {
            from { opacity: 0; }
            to { opacity: 1;}
        }
        .flex-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1.2em 2em;
        }
        .flex-col {
            flex: 1;
            min-width: 180px;
        }
        .section-label {
            color: #004aad;
            font-weight: 600;
            margin-top: 0.5em;
        }
        .fade-up {
            animation: fadeInUp 1.2s;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px);}
            to { opacity: 1; transform: translateY(0);}
        }
        @media (max-width: 800px) {
            .container {
                max-width: 99vw;
                padding: 1em;
            }
            .cours-table th, .cours-table td {
                padding: 0.6em 0.3em;
                font-size: 0.96em;
            }
        }
        @media (max-width: 600px) {
            .flex-row {
                flex-direction: column;
                gap: 0.6em;
            }
            .flex-col {
                min-width: 0;
            }
            .cours-table {
                font-size: 0.93em;
            }
            .cours-section, .user-data {
                padding: 0.7em 0.6em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Bienvenue sur votre espace AlaMath</h2>
        <div id="userInfo"></div>
        <button class="logout-btn" onclick="logout()">Déconnexion</button>
    </div>
    <script>
    // Cookie helpers
    function getSessionCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for(let i=0;i < ca.length;i++) {
            let c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length,c.length));
        }
        return null;
    }
    function eraseSessionCookie(name) {
        document.cookie = name+'=; Max-Age=-99999999; path=/; SameSite=Strict';
    }

    // Affichage utilisateur dynamique (tous les champs, même keyWords)
    function showUserInfo() {
        const userDataString = getSessionCookie('alamathUser');
        if (!userDataString) {
            window.location.href = '/'; // Redirige vers page de login si pas connecté
            return;
        }
        const user = JSON.parse(userDataString);

        // Afficher tous les champs principaux reçus, y compris keyWords
        // Pour un affichage élégant, on peut regrouper les champs connus, puis afficher tous les champs supplémentaires
        const fieldLabels = {
            typetem: "Plateforme",
            userId: "ID",
            nom: "Nom",
            email: "Email",
            tel: "Téléphone",
            usertype: "Type",
            cycle: "Cycle",
            niveau: "Niveau",
            matiere: "Matière",
            keyWords: "Clé de récupération",
            password: "Mot de passe",
            "Date début": "Date début",
            "Nembre de Séance": "Nombre de Séances",
            "Nembre des Séances impayées": "Séances impayées",
            "jour de la prochainne séance": "Prochaine séance",
            "Nom du prof/étudiant": "Prof/Étudiant",
            "Observation": "Observation"
        };

        // Champs principaux dans l'ordre souhaité
        const mainFields = [
            "typetem", "userId", "nom", "email", "tel", "usertype", "cycle", "niveau", "matiere", "keyWords", "password",
            "Date début", "Nembre de Séance", "Nembre des Séances impayées", "jour de la prochainne séance", "Nom du prof/étudiant", "Observation"
        ];

        let html = `<div class="user-data fade-up"><div class="flex-row">`;

        mainFields.forEach(key => {
            if (user[key] && String(user[key]).trim() !== "") {
                html += `<div class="flex-col"><span class="section-label">${fieldLabels[key] || key} :</span><br>${user[key]}</div>`;
            }
        });

        // Affiche tous les champs supplémentaires qui ne sont pas dans mainFields
        Object.keys(user).forEach(key => {
            if (!mainFields.includes(key) && key !== "cours" && user[key] && String(user[key]).trim() !== "") {
                html += `<div class="flex-col"><span class="section-label">${key} :</span><br>${user[key]}</div>`;
            }
        });

        html += `</div></div>`;

        // Section Cours (s'il y en a)
        if(user.cours && Array.isArray(user.cours) && user.cours.length > 0) {
            html += `
            <div class="cours-section fade-up">
                <div class="cours-title">Détails du cours</div>
                <div style="overflow-x:auto">
                <table class="cours-table">
                    <tr>
                        ${Object.keys(user.cours[0]).map(col => `<th>${col}</th>`).join('')}
                    </tr>
                    ${user.cours.map((cours, idx) => `
                        <tr class="dynamic-row">
                            ${Object.keys(cours).map(col => `<td>${cours[col] || ''}</td>`).join('')}
                        </tr>
                    `).join('')}
                </table>
                </div>
            </div>`;
        }
        document.getElementById("userInfo").innerHTML = html;
    }
    showUserInfo();

    function logout() {
        eraseSessionCookie('alamathUser');
        window.location.href = '/';
    }
    </script>
</body>
</html>
