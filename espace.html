<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-store" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Espace - AlaMath</title>
    <style>
        body {
            font-family: 'Poppins', Arial, sans-serif;
            background: #f0f6fb;
            color: #222;
            margin: 0;
            padding: 0;
            text-align: center;
        }
        .container {
            width: 94%;
            max-width: 650px;
            margin: 38px auto;
            background: #fff;
            padding: 32px 20px 20px 20px;
            border-radius: 18px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.13);
            text-align: center;
            animation: fadeIn 0.8s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px);}
            to { opacity: 1; transform: translateY(0);}
        }
        h2 {
            color: #004aad;
            margin-bottom: 0.6em;
        }
        .logout-btn {
            background: #ff4d4d;
            color: white;
            border: none;
            font-size: 1em;
            cursor: pointer;
            border-radius: 7px;
            margin-top: 10px;
            padding: 0.7em 1.3em;
            font-weight: bold;
            transition: background 0.2s;
        }
        .logout-btn:hover {
            background: #c00;
        }
        .user-data {
            text-align: left;
            font-size: 1.13em;
            margin: 1.2em 0;
            padding: 1.1em 1.3em;
            background: #f7faff;
            border-radius: 10px;
            box-shadow: 0 1px 6px #eef4fa;
            animation: fadeIn 1.2s;
        }
        .user-data b {
            color: #004aad;
        }
        .cours-section {
            text-align: left;
            margin: 1.2em 0;
            background: #e7f4ff;
            border-radius: 10px;
            padding: 1.1em 1.3em;
            box-shadow: 0 1px 6px #c5e8ff36;
            animation: fadeIn 1.5s;
        }
        .cours-title {
            font-size: 1.15em;
            font-weight: bold;
            color: #004aad;
            margin-bottom: 0.5em;
        }
        .cours-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 0.7em;
            margin-bottom: 0.8em;
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px #b9e5ff36;
            table-layout: fixed;
            word-break: break-word;
        }
        .cours-table th, .cours-table td {
            border: none;
            padding: 0.75em 0.8em;
            text-align: left;
        }
        .cours-table th {
            background: #dff1ff;
            color: #004aad;
            font-weight: 600;
            font-size: 1em;
            border-bottom: 2px solid #b3dfff;
        }
        .cours-table td {
            background: #f7fcfe;
            border-bottom: 1px solid #e8f4fc;
            font-size: 0.98em;
        }
        .cours-table tr:last-child td {
            border-bottom: none;
        }
        .cours-table tr:nth-child(even) td {
            background: #f0f8fd;
        }
        .dynamic-row {
            animation: rowFadeIn 0.7s;
        }
        @keyframes rowFadeIn {
            from { opacity: 0; }
            to { opacity: 1;}
        }
        .flex-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1.2em 2em;
        }
        .flex-col {
            flex: 1;
            min-width: 180px;
        }
        .section-label {
            color: #004aad;
            font-weight: 600;
            margin-top: 0.5em;
        }
        .fade-up {
            animation: fadeInUp 1.2s;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px);}
            to { opacity: 1; transform: translateY(0);}
        }
        @media (max-width: 800px) {
            .container {
                max-width: 99vw;
                padding: 1em;
            }
            .cours-table th, .cours-table td {
                padding: 0.6em 0.3em;
                font-size: 0.96em;
            }
        }
        @media (max-width: 600px) {
            .flex-row {
                flex-direction: column;
                gap: 0.6em;
            }
            .flex-col {
                min-width: 0;
            }
            .cours-table {
                font-size: 0.93em;
            }
            .cours-section, .user-data {
                padding: 0.7em 0.6em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Bienvenue sur votre espace AlaMath</h2>
        <div id="userInfo"></div>
        <button class="logout-btn" onclick="logout()">Déconnexion</button>
    </div>
    <script>
    // Cookie helpers
    function getSessionCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for(let i=0;i < ca.length;i++) {
            let c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length,c.length));
        }
        return null;
    }
    function eraseSessionCookie(name) {
        document.cookie = name+'=; Max-Age=-99999999; path=/; SameSite=Strict';
    }

    // Affichage utilisateur dynamique
    function showUserInfo() {
        const userDataString = getSessionCookie('alamathUser');
        if (!userDataString) {
            window.location.href = '/'; // Redirige vers page de login si pas connecté
            return;
        }
        const user = JSON.parse(userDataString);

        // Champs à afficher dans l'ordre, texte d'affichage pour chaque champ
        const mainFields = [
            { key: "typetem", label: "Plateforme" },
            { key: "userId", label: "ID" },
            { key: "nom", label: "Nom" },
            { key: "email", label: "Email" },
            { key: "tel", label: "Téléphone" },
            { key: "usertype", label: "Type" },
            { key: "cycle", label: "Cycle" },
            { key: "niveau", label: "Niveau" },
            { key: "matiere", label: "Matière" },
            { key: "Date début", label: "Date début" },
            { key: "Nembre de Séance", label: "Nombre de Séances" },
            { key: "Nembre des Séances impayées", label: "Séances impayées" },
            { key: "jour de la prochainne séance", label: "Prochaine séance" },
            { key: "Nom du prof/étudiant", label: "Prof/Étudiant" },
            { key: "Observation", label: "Observation" }
        ];

        let html = `<div class="user-data fade-up"><div class="flex-row">`;

        mainFields.forEach(field => {
            if (user[field.key] && String(user[field.key]).trim() !== "") {
                html += `<div class="flex-col"><span class="section-label">${field.label} :</span><br>${user[field.key]}</div>`;
            }
        });

        html += `</div></div>`;

        // Section Cours (s'il y en a)
        if(user.cours && Array.isArray(user.cours) && user.cours.length > 0) {
            html += `
            <div class="cours-section fade-up">
                <div class="cours-title">Détails du cours</div>
                <div style="overflow-x:auto">
                <table class="cours-table">
                    <tr>
                        <th>Matière</th>
                        <th>Date début</th>
                        <th>Nb Séances</th>
                        <th>Séances impayées</th>
                        <th>Prochaine séance</th>
                        <th>Prof/Étudiant</th>
                        <th>Observation</th>
                    </tr>
                    ${user.cours.map((cours, idx) => `
                        <tr class="dynamic-row">
                            <td>${cours.matiere || ''}</td>
                            <td>${cours.date_debut || ''}</td>
                            <td>${cours.nbre_seance || user["Nembre de Séance"] || ''}</td>
                            <td>${cours.nbre_seance_impayees || user["Nembre des Séances impayées"] || ''}</td>
                            <td>${cours.prochaine_seance || user["jour de la prochainne séance"] || ''}</td>
                            <td>${cours.prof || user["Nom du prof/étudiant"] || ''}</td>
                            <td>${cours.observation || user["Observation"] || ''}</td>
                        </tr>
                    `).join('')}
                </table>
                </div>
            </div>`;
        }
        document.getElementById("userInfo").innerHTML = html;
    }
    showUserInfo();

    function logout() {
        eraseSessionCookie('alamathUser');
        window.location.href = '/';
    }
    </script>
</body>
</html>
